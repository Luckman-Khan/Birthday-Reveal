<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>Birthday Reveal</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      overflow: hidden;
      touch-action: none;
      background: black;
    }

    img {
      user-select: none;
      -webkit-user-drag: none;
      background-color: transparent !important;
      touch-action: none;
    }

    .app-hidden {
      visibility: hidden;
    }

    @media (orientation: landscape) {
      .portrait-only { display: none; }
      .landscape-message { display: flex; }
    }

    @media (orientation: portrait) {
      .landscape-message { display: none; }
    }
  </style>
</head>
<body>

  <div class="landscape-message hidden md:flex items-center justify-center h-screen text-white text-xl">
    Please rotate to portrait mode ðŸ“±
  </div>

  <div id="app" class="portrait-only relative w-full h-screen overflow-hidden app-hidden">

    <img
      src="./assets/background.jpg"
      class="absolute inset-0 w-full h-full object-cover"
      style="z-index:0; pointer-events:none; transform:translateZ(0);"
      alt="Background"
    />

    <div id="papers-container" class="absolute inset-0"></div>
  </div>

  <script>
    const papers = [
      { src: './assets/paper1.png', z: 5, x: 0,   y: -90, scale: 1.1, rotation: -4 },
      { src: './assets/paper2.png', z: 4, x: -28, y: 90,  scale: 1.1, rotation: 6  },
      { src: './assets/paper3.png', z: 3, x: 40,  y: 62,  scale: 1.1, rotation: -7 },
      { src: './assets/paper4.png', z: 2, x: -50, y: -26, scale: 1.9, rotation: 5  },
      { src: './assets/paper5.png', z: 1, x: 14,  y: -95, scale: 1.4, rotation: -6 }
    ];

    const app = document.getElementById('app');
    const container = document.getElementById('papers-container');

    let activePaper = null;
    let pointers = new Map();
    let startDistance = 0;
    let startScale = 1;
    let startX = 0, startY = 0;

    function distance(p1, p2) {
      return Math.hypot(p1.x - p2.x, p1.y - p2.y);
    }

    function preloadImages(srcs) {
      return Promise.all(
        srcs.map(src => new Promise(res => {
          const img = new Image();
          img.src = src;
          img.onload = res;
          img.onerror = res;
        }))
      );
    }

    preloadImages(papers.map(p => p.src)).then(() => {
      papers.forEach(p => {
        const img = document.createElement('img');

        img.src = p.src;
        img.style.position = 'absolute';
        img.style.top = '50%';
        img.style.left = '50%';
        img.style.width = '40%';
        img.style.zIndex = p.z;

        img.baseX = p.x;
        img.baseY = p.y;
        img.scale = p.scale;

        img.baseTransform = () =>
          `translate(-50%, -50%) translate(${img.baseX}px, ${img.baseY}px)
           rotate(${p.rotation}deg) scale(${img.scale})`;

        img.style.transform = img.baseTransform();
        img.style.willChange = 'transform';

        img.addEventListener('pointerdown', e => {
          e.preventDefault();
          activePaper = img;
          img.setPointerCapture(e.pointerId);
          pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

          startX = e.clientX;
          startY = e.clientY;

          if (pointers.size === 2) {
            const pts = [...pointers.values()];
            startDistance = distance(pts[0], pts[1]);
            startScale = img.scale;
          }

          img.style.filter = 'drop-shadow(0 10px 20px rgba(0,0,0,0.3))';
        });

        img.addEventListener('pointermove', e => {
          if (!activePaper || !pointers.has(e.pointerId)) return;

          pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

          if (pointers.size === 1) {
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            activePaper.style.transform =
              `${activePaper.baseTransform()} translate(${dx}px, ${dy}px) scale(1.04)`;
          }

          if (pointers.size === 2) {
            const pts = [...pointers.values()];
            const newDist = distance(pts[0], pts[1]);
            const scaleFactor = newDist / startDistance;

            activePaper.scale = Math.min(
              3,
              Math.max(0.5, startScale * scaleFactor)
            );

            activePaper.style.transform = activePaper.baseTransform();
          }
        });

        img.addEventListener('pointerup', e => {
          pointers.delete(e.pointerId);

          if (pointers.size === 0 && activePaper) {
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            activePaper.baseX += dx;
            activePaper.baseY += dy;

            activePaper.style.transform = activePaper.baseTransform();
            activePaper.style.filter = '';
            activePaper = null;
          }
        });

        container.appendChild(img);
      });

      app.classList.remove('app-hidden');
    });

    document.addEventListener('contextmenu', e => e.preventDefault());
  </script>

</body>
</html>
